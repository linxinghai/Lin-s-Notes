# ModBus协议

设备地址  功能代码  数据  校验码

## 说明

分类
	
	RTU over
	
	ASCII over
	
	TCP UDP

特点

	开源免费
	
	在多种电气接口及多种通信介质中
	
		串口
		
		以太网
	
	报文帧简单紧凑

存储区

数据类型

	布尔量
	
	寄存器

读写

	只读
	
	读写

读布尔量-输入线圈 -1区(名称)-10001-19999(地址)

只读寄存器-输入寄存器-3区-30001-39999

读写布尔量-输出线圈-0区-00001-9999

读写寄存器-输出寄存器-4区-40001-49999

功能码

	读取输入线圈（0x02），输入寄存器（0x04），输出线圈（0x01），输出寄存器（0x03）
	
	写入单个（多个0x0F）输出线圈（0x05），写入单个（多个0x10）输出寄存器（0x06）

软件

ModbusPoll、ModbusSlave、VSPD(ModbusPoll、

客户端或主站

ModbusSlave

服务器或从站

VSPD

虚拟串口
)

分析

	串行线路中的报文格式
	
	发送报文格式
	
		从站地址 + 功能码 + 数据（变化） + 校验（CRC/LRC）(从站地址

		设备编号，区分，Modbus一主多从
		
		功能码
		
		通过功能码区分识别那个数据
		
		数据
		
		不同功能码返回的数据不同
		
		
		校验)
		
		报文数据结构
		
			起始地址（高/低）
			
			数量（高/低）
			
			一个字节 0-255
		
		起始寄存器 两个字节  0-65535
		
		数量 两个字节
		
		小于3.5个字符的报文间隔时间(为了防止沾包)
	
	接收报文格式
	
		从站地址 + 功能码 ＋　字节计数　＋１（高／低）＋　２（高／低）＋　校验(数字代表几号寄存器)
		
	![[Pasted image 20220629150806.png]]
	ＲＸ：编号　从站地址（０１）功能码（０３）起始（００ ００）数量（００ ０Ａ）校验码（Ｃ５ＣＤ）  
	ＴＸ：编号　从站地址（０１）　功能码（０３）　字节计数（１４）　　  　　　　　　１高（００）２低（０Ｃ）　２高（００）２低（００）．．．．．．．数据（在此为７个寄存器的数据）  　　　　　　８８　２４　校验
	
	轮询(多设备间)

库开发

	编程函数
		
		初始化
		
		打开端口
		
			端口号
			
			波特率
			
			校验位
			
			数据位
			
			停止位
		
		关闭端口
		
		收送数组
		
			报文收发的实现
			
				拼接报文
				
				拼接数组
				
				发送报文
				
					管脚输出
					
					寄存器操作
					
					延时（0.5s）后再接收
				
				接收报文
				
				验证报文
				
				解析报文
			
			高位*256+低位  将两个字节转换成一个整数
			
			高位 = 整数/256  低位 = 整数%256
			
		进制转换(十进制 - 十六进制)